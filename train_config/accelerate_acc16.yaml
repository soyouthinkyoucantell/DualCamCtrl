compute_environment: LOCAL_MACHINE
debug: false

# === 分布式 & 训练主配置 ===
distributed_type: DEEPSPEED
num_processes: 4 # 根据你 GPU 数量设置
num_machines: 1
machine_rank: 0
main_training_function: main

# === Precision 设置 ===
mixed_precision: bf16 # 或 "fp16" 根据硬件支持

# === DeepSpeed 配置 ===

# # Working
# deepspeed_config:
#   gradient_accumulation_steps: 4
#   gradient_clipping: 1.0
#   offload_optimizer_device: cpu
#   zero3_init_flag: false
#   zero_stage: 2

deepspeed_config:
  gradient_accumulation_steps: 16
  gradient_clipping: 1.0
  offload_optimizer_device: cpu
  offload_param_device: cpu
  zero3_init_flag: false
  zero_stage: 2

# deepspeed_config:
#   gradient_accumulation_steps: 2
#   gradient_clipping: 1.0
#   zero_optimization:
#     stage: 2
#     offload_optimizer:
#       device: cpu
#     offload_param:
#       device: cpu
#   zero3_init_flag: false

# === 其他系统设置 ===
gpu_ids: "0,1,2,3"
use_cpu: false
enable_cpu_affinity: false
downcast_bf16: "no"

# === 保留原设置 ===
rdzv_backend: static
same_network: true
tpu_env: []
tpu_use_cluster: false
tpu_use_sudo: false
